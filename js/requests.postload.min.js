import{collectionArr as e}from'/data/records.min.js';let t=[],n=null;const s=document,r=s.getElementById('report'),o=s.getElementById('details_wrap'),c='function'==typeof HTMLDialogElement;s.documentElement.classList.add('noDialogSupport'),'function'==typeof HTMLDialogElement&&s.documentElement.classList.replace('noDialogSupport','dialogSupported');for(const t of e)t.records.sort(((e,t)=>{const n=e.Artist.toLowerCase(),s=t.Artist.toLowerCase();return n<s?-1:n>s?1:0}));(t=>{let n=0;const r='check';function c(e){const t=s.createElement(e.element),n=e.attrs;for(const e in n)t.setAttribute(e,n[e]);return e.inner&&('string'==typeof e.inner?t.textContent=e.inner:'object'==typeof e.inner&&t.appendChild(e.inner)),t}function l(e,t){const n=e.createTHead().insertRow(),s=c({element:'span',attrs:{class:'-visually-hidden'},inner:'Select track'}),r=c({element:'th',attrs:{scope:'col',class:'checks'},inner:s});n.appendChild(r),n.appendChild(function(){const e=c({element:'span',attrs:{class:'-visually-hidden'},inner:'Requested by'});return c({element:'th',attrs:{scope:'col',class:'requestee'},inner:e})}());for(const e of t){const t=c({element:'th',attrs:{scope:'col',class:e.toLowerCase()},inner:e});n.appendChild(t)}return e}function a(e){let t=s.createElement('table');const o=c({element:'caption',attrs:{class:'-visually-hidden'},inner:e.title});t.appendChild(o),t=function(e,t){for(const s of t){let t=e.insertRow();const o=c({element:'input',attrs:{type:'checkbox',name:r+n++}}),l=c({element:'td',attrs:{class:'checks'},inner:o});t.appendChild(l);const a=c({element:'td',attrs:{class:'requestee'},inner:''});t.appendChild(a);let i='';for(const e in s){const n=c({element:'td',attrs:{class:e.toLowerCase()},inner:s[e]});t.appendChild(n),'Artist'===e&&(i=s[e]+':'),'Track'===e&&(i+=s[e])}const d=t.querySelector('input');d.value=i,d.setAttribute('aria-label',i),d.id=i.replace(/ /g,'_')}return e}(t,e.records);return t=l(t,Object.keys(e.records[0])),t}const i=o.querySelectorAll('details');let d=0;for(const t of e){i[d++].styleObj=t}for(const t of i){const n=s.createElement('div');n.className='responsive_wrap';e[t.styleObj];const r=a(t.styleObj);n.appendChild(r),n.details=t,t.appendChild(n)}})();const l=s.getElementById('getUserName'),a=s.getElementById('sentRequest'),i=s.getElementById('name');l.addEventListener('close',(e=>{b(!1),m()})),a.addEventListener('close',(e=>{b(!1),m(),u()})),i.value=localStorage.getItem('name')||'';const d=e=>s.querySelectorAll('input[type=checkbox]:checked'),u=e=>{for(const e of d())e.checked=!1},f='-js-dialogBg',m=e=>{const t=s.querySelector('.'+f);t&&s.body.removeChild(t)},h=e=>{(e=>{if(s.querySelector('.'+f))return;const t=s.createElement('div');t.addEventListener('click',(t=>p(e))),t.classList.add(f),s.body.appendChild(t)})(e),c&&e.showModal(),e.removeAttribute('hidden'),b(!0);const t=e.querySelector('[tabindex]');t&&t.focus()},p=e=>{c&&e.close(),e.setAttribute('hidden','true'),m(),b(!1)},y=e=>{d().length<1||((e=>{const t=s.querySelectorAll('.checkedList');for(const e of t){e.innerHTML='';const t=new DocumentFragment;for(const e of d()){const n=s.createElement('li');n.textContent=e.value.replace(':',' : '),t.appendChild(n)}e.appendChild(t)}})(),h(l))};function q(){const e=(e=>{s.querySelectorAll('.checkedList');const t={name:i.value,requests:[]};for(const e of d()){const[n,s]=e.value.split(':'),r={artist:n,track:s};t.requests.push(r)}return t})();fetch('https://websemantics.uk/records/requests/post-requests/',{method:'POST',body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{L('postRequestData() success: \r\n'+JSON.stringify(e))})).catch((e=>{L('postRequestData() error: \r\n'+JSON.stringify(response))}))}const b=e=>{e?s.body.classList.add('-js-scrollLock'):s.body.classList.remove('-js-scrollLock')},S=e=>{const n=e.closest('.dialog');if(['.btn-close','.btn-more','.btn-finish'].some((t=>e.matches(t))))p(n);else if(e.matches('.btn-submit'))i.checkValidity()?(p(n),(e=>{const t=a;h(t);const n=t.querySelector('[tabindex]');n&&n.focus();let s=`${i.value}'s requests!\n`;t.querySelector('.message').textContent=s})()):i.focus();else if(e.matches('.btn-remove'))i.checkValidity()?(p(n),function(){const e=s.querySelectorAll('input[type=checkbox]:checked');for(const n of e){const[e,s]=n.value.split(':');t=E(t,e,s),n.checked=null}v(t),g(),C(t)}()):i.focus();else if(e.matches('.btn-delete')){confirm('Confirm ALL requests are for deletion?')&&(L('\r\nREMOVING ALL REQUESTS:'),fetch('https://websemantics.uk/records/requests/delete-all-requests/',{method:'POST'}).then((e=>L('\r\ndeleteAllRequestData() success'))).catch((e=>{L('\r\ndeleteAllRequestData() error: \r\n'+e)})))}else e.matches('.btn-refresh')&&k()};s.body.addEventListener('click',(e=>{const t=e.target;'checkbox'!==t.type?t.matches('td')?(e=>{const t=e.parentElement.querySelector('input[type=checkbox]');t&&t.click()})(t):t.matches('button')&&S(t):(e=>{e.focus(),y()})(t)}));s.querySelector('form').addEventListener('submit',(e=>{e.preventDefault(),q(),u()}));const g=e=>{const t=s.querySelectorAll('td.requestee');for(const e of t)e.textContent='',e.parentElement.classList.remove('requested')},C=e=>{for(const t of e){const e=t.name;for(const n of t.requests){const t=(n.artist+':'+n.track).replace(/ /g,'_'),r=s.getElementById(t).closest('td').nextElementSibling;''!==r.textContent&&(r.textContent+='\n'),r.textContent+=e;r.closest('tr').classList.add('requested')}}};function v(e){fetch('https://websemantics.uk/records/requests/rewrite-requests/',{method:'POST',body:JSON.stringify(e)}).then((e=>e.json())).then((e=>L('\r\nrewriteRequestData() success: \r\n'+JSON.stringify(e)))).catch((e=>{L('\r\nrewriteRequestData() error: '+e)}))}const k=e=>{const n=Date.now();r.textContent='Fetching data '+n,fetch('/records/data/requests.json?no-cache='+n,{cache:'no-cache',headers:{'Content-Type':'application/json'},redirects:'manual'}).then((e=>e.json())).then((e=>{L('\r\n JSON fetched:'+JSON.stringify(e),!1),e&&(L('\r\n JSON valid'),L('\r\n JSON DON\'T CARE IF EQUAL'),e=function(e){const t={};for(const n of e){const e=n.name,s=n.requests;t[e]||(t[e]={name:e,requests:new Set}),s.forEach((n=>{const s=`${n.artist}~${n.track}`;t[e].requests.add(s)}))}return Object.values(t).map((e=>({name:e.name,requests:Array.from(e.requests,(e=>{const[t,n]=e.split('~');return{artist:t,track:n}}))}))).filter((e=>e.requests.length>0))}(e),L('\r\n JSON reduced'),g(),C(e),v(e),L('\r\n JSON rewritten to server'),t=e)})).catch((e=>L('\r\nfetchRequestData() error: '+e)))};function E(e,t,n){return e.map((e=>({name:e.name,requests:e.requests.filter((e=>e.artist!==t||e.track!==n))})))}k();!0?(clearInterval(n),n=setInterval(k,1e4)):clearInterval(n);const L=(e,t)=>{t&&(r.textContent=''),r.textContent+=e};